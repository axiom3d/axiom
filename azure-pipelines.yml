trigger:
  - master
  - develop
pr:
  - master
  - develop
  
variables:
  buildConfiguration: 'Release'
  outputDirectory: '$(build.binariesDirectory)/$(buildConfiguration)'
  DOTNET_SDK_VERSION: '3.0.100-preview9-013775'
  
strategy:
  matrix:
    linux:
      imageName: "ubuntu-latest"
    mac:
      imageName: "macos-latest"
    windows:
      imageName: "windows-latest"
  
pool:
  vmImage: $(imageName)
        
steps:
- task: DotNetCoreInstaller@0
  displayName: 'Use .NET Core SDK $(DOTNET_SDK_VERSION)'
  inputs:
    version: '$(DOTNET_SDK_VERSION)'
    
- task: NuGetToolInstaller@1
  displayName: Install NuGet
      
- task: DotNetCoreCLI@2
  displayName: Install dotnet Cake Build Tool
  inputs:
    command: custom
    custom: tool
    arguments: 'install -g Cake.Tool'
  env:
    DOTNET_CLI_TELEMETRY_OPTOUT: 1
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
   
- task: DotNetCoreCLI@2
  displayName: Run dotnet Cake Bootstrapper
  inputs:
    command: custom
    custom: cake
    arguments: 'build.cake --bootstrap'
  env:
    DOTNET_CLI_TELEMETRY_OPTOUT: 1
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1

- task: PowerShell@2
  displayName: Build Product
  inputs:
    targetType: 'inline'
    script: '.\build.ps1 -Script build.cake -Target Build -Verbosity Diagnostic --settings_skipverification=true'
    pwsh: true
